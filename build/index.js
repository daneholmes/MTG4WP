(()=>{"use strict";var e,a={420:(e,a,t)=>{const r=window.wp.blocks,n=window.wp.i18n,s=window.wp.blockEditor,o=window.wp.element,l=window.wp.components,i=window.wp.apiFetch;var c=t.n(i);const d=window.ReactJSXRuntime;(0,r.registerBlockType)("mtg4wp/deck",{edit:({attributes:e,setAttributes:a})=>{const[t,r]=(0,o.useState)(""),[i,m]=(0,o.useState)(""),[p,g]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[w,v]=(0,o.useState)(""),[b,_]=(0,o.useState)({}),{deck:x}=e,j=(e,t,r)=>{const n=[...x];n[e]={...n[e],[t]:r},a({deck:n})},y=(0,s.useBlockProps)();return(0,d.jsxs)("div",{...y,children:[(0,d.jsx)(s.InspectorControls,{children:(0,d.jsx)(l.PanelBody,{title:(0,n.__)("Deck Settings","mtg4wp"),initialOpen:!0,children:(0,d.jsx)(l.PanelRow,{children:(0,d.jsx)(l.Button,{variant:"secondary",onClick:async()=>{try{const e=await c()({path:"/wp/v2/mtg4wp/sort",method:"POST",data:{cards:x.map((e=>({...e,type_line:e.faces?.[0]?.type_line||"",cmc:e.faces?.[0]?.cmc||0}))),sort_by:"name"}});a({deck:e})}catch(e){v((0,n.__)("Error sorting deck. Please try again.","mtg4wp"))}},disabled:!x.length,children:(0,n.__)("Sort by Name","mtg4wp")})})})}),(0,d.jsxs)("div",{className:"mtg4wp-editor",children:[(0,d.jsxs)("div",{className:"mtg4wp-search",children:[(0,d.jsx)(l.TextControl,{label:(0,n.__)("Card Name","mtg4wp"),value:t,onChange:r,help:(0,n.__)("e.g. Brainstorm, Chromatic Star, Plains","mtg4wp")}),(0,d.jsx)(l.TextControl,{label:(0,n.__)("Set Code","mtg4wp"),value:i,onChange:m,help:(0,n.__)("e.g. mmq, brr, pal99","mtg4wp")}),(0,d.jsx)(l.TextControl,{label:(0,n.__)("Collector Number","mtg4wp"),value:p,onChange:g,help:(0,n.__)("e.g. 61, 11, 7","mtg4wp")}),(0,d.jsx)(l.Button,{variant:"primary",onClick:async()=>{h(!0),v("");try{const e=await c()({path:"/wp/v2/mtg4wp/search",method:"POST",data:{card_name:t||"",set:i||void 0,number:p||void 0}});if(null===e)throw new Error("Card not found");a({deck:[...x,e]}),r(""),m(""),g("")}catch(e){v("Card not found"===e.message?(0,n.__)("Card not found. Please verify the card name, set code, or collector number.","mtg4wp"):(0,n.__)("Error finding card. Please try again later.","mtg4wp")),console.error("MTG4WP Error:",e)}finally{h(!1)}},isBusy:u,disabled:u||!t&&(!i||!p),children:(0,n.__)("Add Card","mtg4wp")}),w&&(0,d.jsx)(l.Notice,{status:"error",isDismissible:!1,className:"mtg4wp-error-notice",children:w})]}),(0,d.jsxs)("div",{className:"mtg4wp-deck-list",children:[0===x.length&&(0,d.jsx)(l.Notice,{status:"info",isDismissible:!1,className:"mtg4wp-empty-notice",children:(0,n.__)("Your deck is empty. Try adding some cards using the search form above.","mtg4wp")}),x.map(((e,t)=>{const r=(e=>e.faces&&e.faces.length?e.faces[e.currentFace]||e.faces[0]:null)(e);return r?(0,d.jsx)(l.Card,{className:"mtg4wp-card",children:(0,d.jsx)(l.CardBody,{children:(0,d.jsxs)("div",{className:"mtg4wp-card-layout",children:[(0,d.jsx)("div",{className:"mtg4wp-card-image",children:r.image&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("img",{src:r.image,alt:r.name,width:"146",height:"204",className:"mtg4wp-card-img "+(e.foil?"foil":""),onLoad:()=>_((e=>({...e,[t]:!1}))),style:{display:b[t]?"none":"block"},onError:e=>{e.target.onerror=null,v((0,n.__)("Error loading card image. Please try again.","mtg4wp"))}}),b[t]&&(0,d.jsx)("div",{className:"mtg4wp-card-loading",children:(0,d.jsx)(l.Spinner,{})}),e.isDoubleFaced&&(0,d.jsx)(l.Button,{variant:"secondary",className:"mtg4wp-card-flip",onClick:()=>(e=>{const t=[...x],r=t[e];r.currentFace=0===r.currentFace?1:0,a({deck:t})})(t),children:(0,n.__)("Flip","mtg4wp")})]})}),(0,d.jsxs)("div",{className:"mtg4wp-card-content",children:[(0,d.jsxs)("div",{className:"mtg4wp-card-header",children:[(0,d.jsx)("h4",{children:e.name}),(0,d.jsx)(l.Button,{variant:"secondary",isDestructive:!0,onClick:()=>(e=>{const t=[...x];t.splice(e,1),a({deck:t}),_((a=>{const t={...a};delete t[e];const r={};return Object.keys(t).forEach((a=>{const n=parseInt(a);n>e?r[n-1]=t[a]:r[a]=t[a]})),r}))})(t),children:(0,n.__)("Remove","mtg4wp")})]}),(0,d.jsxs)("div",{className:"mtg4wp-card-controls",children:[(0,d.jsx)(l.__experimentalNumberControl,{label:(0,n.__)("Quantity","mtg4wp"),value:e.quantity,onChange:e=>j(t,"quantity",parseInt(e)||1),min:1}),(0,d.jsx)(l.SelectControl,{label:(0,n.__)("Section","mtg4wp"),value:e.section,options:[{label:"Commander",value:"commander"},{label:"Mainboard",value:"mainboard"},{label:"Sideboard",value:"sideboard"},{label:"Maybeboard",value:"maybeboard"},{label:"Token",value:"token"}],onChange:e=>j(t,"section",e)}),(0,d.jsx)(l.ToggleControl,{label:(0,n.__)("Foil","mtg4wp"),checked:e.foil,onChange:e=>j(t,"foil",e)})]})]})]})})},t):null}))]})]})]})},save:({attributes:e})=>{const a=s.useBlockProps.save(),{deck:t}=e;return(0,d.jsx)("div",{...a,children:(0,d.jsx)("div",{className:"mtg4wp-deck",children:t.map(((e,a)=>(0,d.jsxs)("div",{className:"mtg4wp-card","data-card-name":e.name,children:[e.quantity,"x ",e.name]},a)))})})}})}},t={};function r(e){var n=t[e];if(void 0!==n)return n.exports;var s=t[e]={exports:{}};return a[e](s,s.exports,r),s.exports}r.m=a,e=[],r.O=(a,t,n,s)=>{if(!t){var o=1/0;for(d=0;d<e.length;d++){for(var[t,n,s]=e[d],l=!0,i=0;i<t.length;i++)(!1&s||o>=s)&&Object.keys(r.O).every((e=>r.O[e](t[i])))?t.splice(i--,1):(l=!1,s<o&&(o=s));if(l){e.splice(d--,1);var c=n();void 0!==c&&(a=c)}}return a}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[t,n,s]},r.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return r.d(a,{a}),a},r.d=(e,a)=>{for(var t in a)r.o(a,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},r.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={57:0,350:0};r.O.j=a=>0===e[a];var a=(a,t)=>{var n,s,[o,l,i]=t,c=0;if(o.some((a=>0!==e[a]))){for(n in l)r.o(l,n)&&(r.m[n]=l[n]);if(i)var d=i(r)}for(a&&a(t);c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(d)},t=globalThis.webpackChunkMTG4WP=globalThis.webpackChunkMTG4WP||[];t.forEach(a.bind(null,0)),t.push=a.bind(null,t.push.bind(t))})();var n=r.O(void 0,[350],(()=>r(420)));n=r.O(n)})();